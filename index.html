<!-- Sorting Hat â€” Compact Reveal Design (HTML/CSS/JS) with BIG Magical Logos -->
<!--
  Update:
  - Logos are BIG and animated (rise + pulse + sparkle + shine sweep) for a magical feel.
  - On Sort: setup hides â†’ four house cards pop in â†’ then names reveal slowly.
  - Balanced distribution; hidden rig (Shift+R / tripleâ€‘click title / ?rig=1).
  - Uses your logos: griffindor.png, hufflepuff.png, slytherin.png, ravenclaw.png.
  - Self-tests available with ?debug=1.
-->
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Sorting Hat</title>
  <style>
    :root {
      --bg: #0a0a0b;
      --card: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.18);
      --muted: rgba(255,255,255,0.8);
      --accent: #36d399;
      --gry: #dc2626; /* red */
      --sly: #059669; /* green */
      --rav: #0ea5e9; /* blue */
      --huf: #f59e0b; /* yellow */
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; background: radial-gradient(1000px 700px at 50% 0%, #111 0%, var(--bg) 60%); color:#fff; }

    .wrap { max-width: 820px; margin: 0 auto; padding: 18px 16px 40px; }
    .header { display:flex; align-items:center; gap:10px; user-select:none; cursor: default; padding:6px 0; }
    .header h1 { margin:0; font-size: clamp(18px, 2.4vw, 26px); letter-spacing: .3px; color:#e7e7ea; }
    .rig-ind { width:10px; height:10px; border-radius:50%; background:#444; box-shadow:0 0 10px #000; }
    .rig-on { background: var(--accent); box-shadow:0 0 14px var(--accent); }
    .status { font-size: 12px; color:#cbd5e1; margin-left: 8px; }

    .card { background: var(--card); border: 1px solid var(--border); border-radius: 18px; overflow:hidden; }
    .hidden { display:none !important; }

    .hatBox { position: relative; height: clamp(200px, 45vh, 500px); display:flex; align-items:center; justify-content:center; background:#000; }
    /* .hatBox video { width: 100%; height: 100%; object-fit: cover; opacity: .9; } */
    .hatBox img { width: 25rem; height: 25rem; object-fit: contain; }
    .hatEmoji { position:absolute; font-size: clamp(60px, 9vw, 110px); filter: drop-shadow(0 10px 16px rgba(0,0,0,.55)); animation: float 3.6s ease-in-out infinite; }
    @keyframes float { 0%{ transform: translateY(0) rotate(-2deg);} 50%{ transform: translateY(-10px) rotate(2deg);} 100%{ transform: translateY(0) rotate(-2deg);} }

    .io { padding: 12px; display:flex; flex-direction: column; gap:10px; border-top: 1px solid var(--border); }
    .io textarea { width:100%; min-height: 64px; max-height: 200px; padding: 10px; border-radius: 12px; background:#0e0e10; color:#fff; border:1px solid var(--border); resize: vertical; }
    .io .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .io button { padding: 11px 16px; border-radius: 12px; background:#3b82f6; border:1px solid rgba(255,255,255,.15); color:#fff; font-weight:700; cursor:pointer; }
    .io button.secondary { background:#202329; }

    /* Reveal grid (hidden until sort) */
    .reveal { margin-top: 18px; display:none; }
    .reveal.on { display:block; }
    .grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:16px; }
    @media (max-width: 620px){ .grid { grid-template-columns: 1fr; } }

    /* POP Card */
    .houseCard { position: relative; border: 1px solid var(--border); border-radius: 16px; overflow:hidden; background: rgba(255,255,255,.04); opacity: 0; transform: translateY(12px) scale(.9); animation: cardPop .6s cubic-bezier(.2,.9,.2,1) forwards; }
    @keyframes cardPop { 0% { opacity:0; transform: translateY(12px) scale(.9);} 60%{ opacity:1; transform: translateY(-3px) scale(1.03);} 100%{ opacity:1; transform: translateY(0) scale(1);} }

    /* BIG, magical logos */
    .houseLogoWrap { position: relative; display:flex; align-items:center; justify-content:center; padding: 22px 22px 10px; }
    .houseLogo { width: clamp(120px, 26vw, 190px); height: auto; object-fit: contain; filter: drop-shadow(0 16px 22px rgba(0,0,0,.55));
                 animation: logoRise .9s cubic-bezier(.2,.9,.2,1) both, logoPulse 4.2s ease-in-out 1.2s infinite; transform-origin: 50% 60%; }
    @keyframes logoRise { 0% { opacity:0; transform: translateY(14px) scale(.82) rotate(-2deg);} 60% {opacity:1; transform: translateY(-6px) scale(1.1) rotate(1.5deg);} 100% {opacity:1; transform: translateY(0) scale(1) rotate(0);} }
    @keyframes logoPulse { 0% { transform: translateY(0) scale(1);} 50% { transform: translateY(-2px) scale(1.035);} 100% { transform: translateY(0) scale(1);} }

    /* Shine sweep */
    .houseLogoWrap::after { content:""; position:absolute; top:0; left:-40%; width:38%; height:100%; pointer-events:none; background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.16) 50%, rgba(255,255,255,0) 100%); transform: skewX(-20deg);
                            animation: shine 4.8s ease-in-out 1.1s infinite; }
    @keyframes shine { 0% { left:-50%; } 22% { left:120%; } 100% { left:120%; } }

    /* Sparkles */
    .sparkleWrap { position:absolute; inset:0; pointer-events:none; }
    .sparkle { position:absolute; width:6px; height:6px; border-radius:50%; background: radial-gradient(circle, rgba(255,255,255,.95), rgba(255,255,255,.1)); opacity:0; animation: twinkle 2.2s ease-in-out infinite; }
    @keyframes twinkle { 0%,100%{ transform: scale(.4); opacity:0; } 50% { transform: scale(1); opacity:1; } }

    .houseTitle { text-align:center; font-weight:800; letter-spacing:.3px; margin: 0 0 8px; opacity: 0; transform: translateY(6px); animation: titleIn .5s ease forwards; animation-delay: .55s; }
    @keyframes titleIn { to { opacity:1; transform: translateY(0);} }
    .houseTitle.gry { color: var(--gry); }
    .houseTitle.sly { color: var(--sly); }
    .houseTitle.rav { color: var(--rav); }
    .houseTitle.huf { color: var(--huf); }

    .chips { display:flex; flex-wrap: wrap; gap:8px; padding: 0 12px 14px; }
    .chip { display:inline-flex; align-items:center; gap:6px; padding:7px 10px; border-radius: 999px; border:1px solid rgba(255,255,255,.16); background: rgba(255,255,255,.06); font-size: 13px; color:#f3f4f6; opacity:0; transform: translateY(6px) scale(.95); animation: pop .45s forwards; }
    .chip .logoImg { width:16px; height:16px; object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,.3)); }
    .chip.gry { box-shadow: 0 0 0 1px rgba(220,38,38,.25) inset, 0 0 14px rgba(220,38,38,.15); }
    .chip.sly { box-shadow: 0 0 0 1px rgba(5,150,105,.25) inset, 0 0 14px rgba(5,150,105,.15); }
    .chip.rav { box-shadow: 0 0 0 1px rgba(14,165,233,.25) inset, 0 0 14px rgba(14,165,233,.15); }
    .chip.huf { box-shadow: 0 0 0 1px rgba(245,158,11,.25) inset, 0 0 14px rgba(245,158,11,.15); }
    @keyframes pop{ to { opacity:1; transform: translateY(0) scale(1);} }

    /* Debug badges */
    .badges { margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; }
    .badge { display:inline-flex; align-items:center; gap:6px; padding:6px 8px; border-radius:999px; border:1px solid var(--border); background: rgba(255,255,255,.05); font-size:12px; color:#e5e7eb; }
    .pass { color: var(--accent); border-color: rgba(54,211,153,.4); }
    .fail { color: #fb7185; border-color: rgba(251,113,133,.4); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header" id="title">
      <div class="rig-ind" id="rigDot" title="Rig status"></div>
      <h1>âš¡ The Sorting Hat</h1>
      <span class="status" id="status">Ready.</span>
    </div>

    <div class="card" id="setupCard">
      <div class="hatBox">
        <!-- Replace with your local clip: assets/hat.mp4  -->
         <img src="assets/sortinghat.gif" alt="ðŸŽ©" />
        <!-- <video id="hatVid" autoplay muted loop playsinline>
          <source src="" type="video/mp4" />
        </video>
        <div class="hatEmoji" id="hatEmoji">ðŸŽ©</div> -->
      </div>
      <div class="io">
        <textarea id="names" placeholder="Paste all names here (comma or new line)"></textarea>
        <div class="row">
          <button id="btnSort">Sort</button>
          <button class="secondary" id="btnShuffle">Shuffle</button>
          <span class="status" id="ioStatus"></span>
        </div>
        <!-- <span class="status">Tip: Tripleâ€‘click the title or press Shift+R to toggle rig. Use ?rig=1 in URL to force rig.</span> -->
      </div>
    </div>

    <!-- Hidden until we sort -->
    <div class="reveal" id="reveal">
      <div class="grid" id="grid"></div>
      <div class="badges" id="debugBadges"></div>
    </div>
  </div>

  <script>
    // ==== Logo files (as provided) ====
    const LOGOS = {
      Gryffindor: 'griffindor.png',
      Hufflepuff: 'hufflepuff.png',
      Slytherin: 'slytherin.png',
      Ravenclaw: 'ravenclaw.png',
    };

    const COLORS = {
      Gryffindor: '#dc2626',
      Slytherin: '#059669',
      Ravenclaw: '#0ea5e9',
      Hufflepuff: '#f59e0b',
    };

    // ==== Optional: put your rigged mapping here ====
    // Case-insensitive keys. Example:
    const RIG = { "Kokila": "Gryffindor", "Meena": "Hufflepuff", "Monisha": "Ravenclaw", "Simla": "Slytherin", "Arthi": "Hufflepuff" };
    // const RIG = {};

    const HOUSES = ["Gryffindor", "Slytherin", "Ravenclaw", "Hufflepuff"];

    // Hidden rig switch
    const rigParam = new URLSearchParams(location.search).get('rig');
let rig = rigParam === '1'
    const rigDot = document.getElementById('rigDot');
    const title = document.getElementById('title');
    function updateRigDot(){ 
      rigDot.classList.toggle('rig-on', rig); 
      rigDot.title = rig ? 'Rig: ON' : 'Rig: OFF'; 
    }
    updateRigDot();
    let clicks=0, clickTimer; title.addEventListener('click', ()=>{ clicks++; clearTimeout(clickTimer); clickTimer=setTimeout(()=>{ if(clicks>=3){ rig=!rig; updateRigDot(); } clicks=0; }, 350); });
    window.addEventListener('keydown', (e)=>{ if(e.key.toLowerCase()==='r' && e.shiftKey){ rig=!rig; updateRigDot(); }});

    // Elements
    const elSetup = document.getElementById('setupCard');
    const elNames = document.getElementById('names');
    const elBtnSort = document.getElementById('btnSort');
    const elBtnShuffle = document.getElementById('btnShuffle');
    const elBtnExample = document.getElementById('btnExample');
    const elStatus = document.getElementById('status');
    const elIoStatus = document.getElementById('ioStatus');
    const elReveal = document.getElementById('reveal');
    const elGrid = document.getElementById('grid');

    // Video fallback
    const vid = document.getElementById('hatVid');
    const emoji = document.getElementById('hatEmoji');
    const VIDEO_SRC = '';// put 'assets/hat.mp4' here if you have a file
    if (VIDEO_SRC){ vid.querySelector('source').setAttribute('src', VIDEO_SRC); vid.load(); vid.style.display='block'; emoji.style.display='none'; }

    // Utils
    const norm = s => s.trim();
    function parseNames(text){ return text.split(/[\n,]/).map(norm).filter(Boolean); }
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
    function quotas(total){ const base = Math.floor(total/4), rem = total % 4; const order = shuffle(HOUSES.slice()); const q = { Gryffindor: base, Slytherin: base, Ravenclaw: base, Hufflepuff: base }; for(let i=0;i<rem;i++) q[order[i]]++; return q; }
    function canonHouse(h){
      const s = String(h||'').toLowerCase();
      if (s.startsWith('gry')) return 'Gryffindor';
      if (s.startsWith('sly')) return 'Slytherin';
      if (s.startsWith('rav')) return 'Ravenclaw';
      if (s.startsWith('huf')) return 'Hufflepuff';
      return null;
    }

    function lowerMap(map){ const out={}; for(const k in map){ const canon = canonHouse(map[k]); out[k.toLowerCase()] = canon || map[k]; } return out; }

    function assignBalanced(allNames, useRig){
      const result = { Gryffindor:[], Slytherin:[], Ravenclaw:[], Hufflepuff:[] };
      const q = quotas(allNames.length);
      const remaining = [];
      const rigMap = lowerMap(RIG);
debugger
      for(const raw of allNames){
        const key = raw.toLowerCase();
        if(useRig && rigMap[key]){
          const h = rigMap[key];
          if(q[h] > 0){ 
            result[h].push(raw); 
            // q[h]--; 
          } else { 
            remaining.push(raw); 
          }
        } else { remaining.push(raw); }
      }
      shuffle(remaining);
      for(const name of remaining){
        const available = HOUSES.filter(h => q[h] > 0);
        const h = available.length ? available[Math.floor(Math.random()*available.length)] : HOUSES[Math.floor(Math.random()*4)];
        result[h].push(name); q[h] = Math.max(0, q[h]-1);
      }
      return result;
    }

    function cssClass(h){ return h==='Gryffindor'?'gry':h==='Slytherin'?'sly':h==='Ravenclaw'?'rav':'huf'; }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    function buildHouseCard(house){
      const card = document.createElement('div');
      card.className = `houseCard ${cssClass(house)}`;
      card.dataset.house = house;
      card.innerHTML = `
        <div class="houseLogoWrap">
          <img class="houseLogo" src="assets/${LOGOS[house]}" alt="${house} logo" />
          <div class="sparkleWrap"></div>
        </div>
        <h3 class="houseTitle ${cssClass(house)}">${house}</h3>
        <div class="chips"></div>
      `;
      // add sparkles
      addSparkles(card, house);
      return card;
    }

    function addSparkles(card, house){
      const wrap = card.querySelector('.sparkleWrap');
      const color = COLORS[house] || '#ffffff';
      const N = 14;
      for(let i=0;i<N;i++){
        const s = document.createElement('span');
        s.className = 'sparkle';
        // position sparkles roughly around the center region
        const left = 30 + Math.random()*40; // %
        const top = 18 + Math.random()*46;  // %
        s.style.left = left + '%';
        s.style.top = top + '%';
        s.style.boxShadow = `0 0 10px ${color}66, 0 0 20px ${color}33`;
        s.style.animationDelay = (Math.random()*2.2).toFixed(2) + 's';
        s.style.animationDuration = (1.6 + Math.random()*2.2).toFixed(2) + 's';
        wrap.appendChild(s);
      }
    }

    function addNamesSlow(assign, startDelay){
      let delay = startDelay; // ms
      const CHIP_STEP = 180; // slower reveal per chip
      for(const h of HOUSES){
        const host = elGrid.querySelector(`.houseCard[data-house="${h}"] .chips`);
        for(const n of assign[h]){
          setTimeout(()=>{
            const chip = document.createElement('span');
            chip.className = `chip ${cssClass(h)}`;
            // const img = document.createElement('img');
            // img.className = 'logoImg';
            // img.src = LOGOS[h];
            // img.alt = `${h} logo`;
            // chip.appendChild(img);
            chip.insertAdjacentText('beforeend', ' ' + n);
            host.appendChild(chip);
          }, delay);
          delay += CHIP_STEP;
        }
      }
    }

    function reveal(assign){
      elGrid.innerHTML = '';
      const order = HOUSES.slice();
      const POP_DUR = 600; // match @keyframes cardPop
      const POP_STAGGER = 160;

      // Build cards and stagger their pop via animationDelay
      order.forEach((h, idx) => {
        const card = buildHouseCard(h);
        card.style.animationDelay = (idx * POP_STAGGER) + 'ms';
        card.querySelector('.houseTitle').style.animationDelay = (0.55 + idx * (POP_STAGGER/1000)) + 's';
        elGrid.appendChild(card);
      });

      // Hide setup, show reveal
      elSetup.classList.add('hidden');
      elReveal.classList.add('on');

      // After all cards popped -> confetti + slowly add names
      const totalDelay = (order.length - 1) * POP_STAGGER + POP_DUR + 200;
      setTimeout(()=>{
        confettiBurst();
        addNamesSlow(assign, 0);
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      }, totalDelay);
    }

    function sortNow(){
      const names = parseNames(elNames.value);
      if(names.length===0){ elIoStatus.textContent='Enter some names.'; return; }
      const unique = Array.from(new Set(names));
      elIoStatus.textContent = (unique.length !== names.length) ? `Removed duplicates: ${names.length-unique.length}` : 'Sorted.';
      const assign = assignBalanced(unique, rig);
      reveal(assign);
    }

    // Events
    elBtnSort.addEventListener('click', sortNow);
    elBtnShuffle.addEventListener('click', ()=>{ const names = parseNames(elNames.value); shuffle(names); elNames.value = names.join('\n'); });
    // elBtnExample.addEventListener('click', ()=>{ elNames.value = ['Nirmal','Ajay','Gabriel','Sifat'].join('\n'); });

    // Confetti (light)
    function confettiBurst(){
      const c = document.createElement('canvas');
      c.width = innerWidth; c.height = 200; c.style.position='fixed'; c.style.left='0'; c.style.top='0'; c.style.pointerEvents='none'; c.style.zIndex='9999';
      document.body.appendChild(c);
      const ctx = c.getContext('2d');
      const cols = [ '#ef4444','#22c55e','#38bdf8','#f59e0b' ];
      const parts = Array.from({length: 110},()=>({ x: Math.random()*innerWidth, y: -20, vx: (Math.random()-0.5)*2, vy: Math.random()*2+2, r: Math.random()*3+2, col: cols[Math.floor(Math.random()*cols.length)] }));
      let t=0; const tick=()=>{ t++; ctx.clearRect(0,0,c.width,c.height); parts.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; ctx.fillStyle=p.col; ctx.fillRect(p.x,p.y,p.r,p.r); }); if(t<120) requestAnimationFrame(tick); else document.body.removeChild(c); };
      tick();
    }

    // Self tests (debug)
    const debug = new URLSearchParams(location.search).get('debug')==='1';
    function testEqualDistribution(){ const names = Array.from({length: 17}, (_,i)=>`P${i+1}`); const a = assignBalanced(names, false); const counts = HOUSES.map(h=>a[h].length); const max = Math.max(...counts), min = Math.min(...counts); return (max-min) <= 1; }
    function testRigRespected(){ const rigLocal = { 'p1':'Gryffindor','p2':'Slytherin','p3':'Ravenclaw','p4':'Hufflepuff' }; const old = Object.assign({}, RIG); Object.assign(RIG, rigLocal); const a = assignBalanced(['P1','P2','P3','P4','P5','P6','P7','P8'], true); const pass = a['Gryffindor'].includes('P1') && a['Slytherin'].includes('P2') && a['Ravenclaw'].includes('P3') && a['Hufflepuff'].includes('P4'); for(const k in RIG) delete RIG[k]; for(const k in old) RIG[k]=old[k]; return pass; }
    function renderBadges(){ if(!debug) return; const host = document.getElementById('debugBadges'); host.innerHTML = ''; const b1 = document.createElement('span'); b1.className='badge ' + (testEqualDistribution()?'pass':'fail'); b1.textContent='Test: equal distribution'; host.appendChild(b1); const b2 = document.createElement('span'); b2.className='badge ' + (testRigRespected()?'pass':'fail'); b2.textContent='Test: rig respected'; host.appendChild(b2); console.table({ equalDistribution: testEqualDistribution(), rigRespected: testRigRespected() }); }
    renderBadges();
  </script>
</body>
</html>
